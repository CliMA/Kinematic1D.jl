using Plots

"""
    Create plots comparing the Julia & PySDM vertical profiles
"""
function plot_comparison(KM_data, sdm_case="dry",dir="dry")
    sdm_data = load_sdm_data(sdm_case)
    path = joinpath(@__DIR__, "output", dir)
    
    p1 = Plots.plot(KM_data.q_vap, z_centers, 
        label="KM",
        xlabel="q_vap [g/kg]",
        ylabel="z [m]")
    Plots.plot!(p1, sdm_data.qv_sdm, sdm_data.z_sdm, label="SDM")

    p2 = Plots.plot(KM_data.ρ, z_centers, 
        label="KM ρ_tot",
        xlabel="ρ [kg/m3]",
        ylabel="z [m]")
    Plots.plot!(p2, sdm_data.rhod_sdm, sdm_data.z_sdm, label="SDM ρ_dry")
    
    p3 = Plots.plot(KM_data.θ_dry, z_centers, 
        label="KM",
        xlabel="θ_dry [K]",
        ylabel="z [m]")
    Plots.plot!(p3, sdm_data.thetad_sdm, sdm_data.z_sdm, label="SDM")

    p4 = Plots.plot(KM_data.T, z_centers, 
        label="KM",
        xlabel="T [K]",
        ylabel="z [m]")
    Plots.plot!(p4, sdm_data.T_sdm, sdm_data.z_sdm, label="SDM")

    p5 = Plots.plot(KM_data.p, z_centers, 
        label="KM",
        xlabel="p [Pa]",
        ylabel="z [m]")
    Plots.plot!(p5, sdm_data.P_sdm, sdm_data.z_sdm, label="SDM")

    p6 = Plots.plot(KM_data.q_liq, z_centers, 
        label="KM",
        xlabel="q_liq [g/kg]",
        ylabel="z [m]")
    Plots.plot!(p6, sdm_data.ql_sdm, sdm_data.z_sdm, label="SDM")
    
    p = Plots.plot(p1, p2, p3, p4, p5, p6)
    Plots.png(p, joinpath(path, "init_profile.png"))
end

"""
    Load the statically-stored PySDM profiles
"""
function load_sdm_data(case="dry")
    # Reference data from PySDM
    z_sdm = [  50.,  150.,  250.,  350.,  450.,  550.,  650.,  750.,  850.,
    950., 1050., 1150., 1250., 1350., 1450., 1550., 1650., 1750.,
    1850., 1950., 2050., 2150., 2250., 2350., 2450., 2550., 2650.,
    2750., 2850., 2950.]
   
    qv_sdm = [0.01491892, 0.01475676, 0.01459459, 0.01443243, 0.01427027,
    0.01410811, 0.01394595, 0.01375476, 0.01330238, 0.01285   ,
    0.01239762, 0.01194524, 0.01149286, 0.01104048, 0.0105881 ,
    0.01013571, 0.00968333, 0.00923095, 0.00877857, 0.00832619,
    0.00787381, 0.00742143, 0.00696905, 0.00651667, 0.00606429,
    0.0056119 , 0.00515952, 0.00470714, 0.00425476, 0.00380238]

    rhod_sdm = [1.14305196, 1.13364302, 1.12428051, 1.11496436, 1.1056945 ,
    1.09647084, 1.08729331, 1.07816201, 1.06909122, 1.06009053,
    1.05115935, 1.04229713, 1.03350333, 1.02477739, 1.01611878,
    1.00752696, 0.99900141, 0.99054159, 0.982147  , 0.97381711,
    0.96555141, 0.9573494 , 0.94921057, 0.94113443, 0.93312049,
    0.92516826, 0.91727725, 0.909447  , 0.90167701, 0.89396682]

    thetad_sdm = [299.9237387 , 299.90192459, 299.88010651, 299.85828446,
    299.83645843, 299.81462843, 299.79279445, 299.82598628,
    300.35429564, 300.8823342 , 301.41010174, 301.93759804,
    302.46482289, 302.99177605, 303.5184573 , 304.04486643,
    304.5710032 , 305.0968674 , 305.6224588 , 306.14777717,
    306.6728223 , 307.19759395, 307.7220919 , 308.24631593,
    308.7702658 , 309.29394129, 309.81734218, 310.34046824,
    310.86331923, 311.38589493]

    T_sdm = [297.98738981, 296.97424724, 295.96127791, 294.94848185,
    293.93585907, 292.92340959, 291.91113344, 290.97379845,
    290.70826576, 290.44067019, 290.17101393, 289.89930083,
    289.62553474, 289.3497195 , 289.07185895, 288.79195689,
    288.51001716, 288.22604355, 287.94003986, 287.65200987,
    287.36195737, 287.06988612, 286.7757999 , 286.47970244,
    286.1815975 , 285.88148882, 285.57938011, 285.27527511,
    284.96917753, 284.66109106]

    P_sdm = [100102.76133281,  98916.03374389,  97739.59176678,  96573.37866679,
    95417.33785072,  94271.41286689,  93135.54740511,  92029.14614963,
    91106.72124606,  90192.2509342 ,  89285.67243933,  88386.92530754,
    87495.94953388,  86612.68555877,  85737.0742643 ,  84869.0569707 ,
    84008.57543269,  83155.57183604,  82309.988794  ,  81471.76934389,
    80640.85694365,  79817.19546843,  79000.72920727,  78191.4028597 ,
    77389.16153251,  76593.95073643,  75805.71638293,  75024.40478097,
    74249.96263386,  73482.3370361 ]

    ql_sdm = [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
    0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]

    return (; z_sdm, qv_sdm, rhod_sdm, thetad_sdm, T_sdm, P_sdm, ql_sdm)
end
