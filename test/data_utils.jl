using Plots

"""
    Create plots comparing the Julia & PySDM vertical profiles
"""
function plot_comparison(KM_data; sdm_case="dry", dir="dry")
    sdm_data = load_sdm_data(sdm_case)
    path = joinpath(@__DIR__, "output", dir)
    
    p1 = Plots.plot(KM_data.q_vap, z_centers, 
        label="KM",
        xlabel="q_vap [g/kg]",
        ylabel="z [m]")
    Plots.plot!(p1, sdm_data.qv_sdm, sdm_data.z_sdm, label="SDM")

    p2 = Plots.plot(KM_data.ρ, z_centers, 
        label="KM ρ_tot",
        xlabel="ρ [kg/m3]",
        ylabel="z [m]")
    Plots.plot!(p2, sdm_data.rhod_sdm, sdm_data.z_sdm, label="SDM ρ_dry")
    
    p3 = Plots.plot(KM_data.θ_dry, z_centers, 
        label="KM",
        xlabel="θ_dry [K]",
        ylabel="z [m]")
    Plots.plot!(p3, sdm_data.thetad_sdm, sdm_data.z_sdm, label="SDM")

    p4 = Plots.plot(KM_data.T, z_centers, 
        label="KM",
        xlabel="T [K]",
        ylabel="z [m]")
    Plots.plot!(p4, sdm_data.T_sdm, sdm_data.z_sdm, label="SDM")

    p5 = Plots.plot(KM_data.p, z_centers, 
        label="KM",
        xlabel="p [Pa]",
        ylabel="z [m]")
    Plots.plot!(p5, sdm_data.P_sdm, sdm_data.z_sdm, label="SDM")

    p6 = Plots.plot(KM_data.q_liq, z_centers, 
        label="KM",
        xlabel="q_liq [g/kg]",
        ylabel="z [m]")
    Plots.plot!(p6, sdm_data.ql_sdm, sdm_data.z_sdm, label="SDM")
    
    p = Plots.plot(p1, p2, p3, p4, p5, p6, size=(1000,600))
    Plots.png(p, joinpath(path, "init_profile.png"))
end

"""
    Load the statically-stored PySDM profiles
"""
function load_sdm_data(case="dry")
    # Reference data from PySDM
    z_sdm = [  50.,  150.,  250.,  350.,  450.,  550.,  650.,  750.,  850.,
    950., 1050., 1150., 1250., 1350., 1450., 1550., 1650., 1750.,
    1850., 1950., 2050., 2150., 2250., 2350., 2450., 2550., 2650.,
    2750., 2850., 2950.]

    ql_sdm = [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
    0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]

    if case=="wet"
        qv_sdm = [0.01491892, 0.01475676, 0.01459459, 0.01443243, 0.01427027,
        0.01410811, 0.01394595, 0.01375476, 0.01330238, 0.01285   ,
        0.01239762, 0.01194524, 0.01149286, 0.01104048, 0.0105881 ,
        0.01013571, 0.00968333, 0.00923095, 0.00877857, 0.00832619,
        0.00787381, 0.00742143, 0.00696905, 0.00651667, 0.00606429,
        0.0056119 , 0.00515952, 0.00470714, 0.00425476, 0.00380238]

        rhod_sdm = [1.14305196, 1.13364302, 1.12428051, 1.11496436, 1.1056945 ,
        1.09647084, 1.08729331, 1.07816201, 1.06909122, 1.06009053,
        1.05115935, 1.04229713, 1.03350333, 1.02477739, 1.01611878,
        1.00752696, 0.99900141, 0.99054159, 0.982147  , 0.97381711,
        0.96555141, 0.9573494 , 0.94921057, 0.94113443, 0.93312049,
        0.92516826, 0.91727725, 0.909447  , 0.90167701, 0.89396682]

        thetad_sdm = [299.9237387 , 299.90192459, 299.88010651, 299.85828446,
        299.83645843, 299.81462843, 299.79279445, 299.82598628,
        300.35429564, 300.8823342 , 301.41010174, 301.93759804,
        302.46482289, 302.99177605, 303.5184573 , 304.04486643,
        304.5710032 , 305.0968674 , 305.6224588 , 306.14777717,
        306.6728223 , 307.19759395, 307.7220919 , 308.24631593,
        308.7702658 , 309.29394129, 309.81734218, 310.34046824,
        310.86331923, 311.38589493]

        T_sdm = [297.98738981, 296.97424724, 295.96127791, 294.94848185,
        293.93585907, 292.92340959, 291.91113344, 290.97379845,
        290.70826576, 290.44067019, 290.17101393, 289.89930083,
        289.62553474, 289.3497195 , 289.07185895, 288.79195689,
        288.51001716, 288.22604355, 287.94003986, 287.65200987,
        287.36195737, 287.06988612, 286.7757999 , 286.47970244,
        286.1815975 , 285.88148882, 285.57938011, 285.27527511,
        284.96917753, 284.66109106]

        P_sdm = [100102.76133281,  98916.03374389,  97739.59176678,  96573.37866679,
        95417.33785072,  94271.41286689,  93135.54740511,  92029.14614963,
        91106.72124606,  90192.2509342 ,  89285.67243933,  88386.92530754,
        87495.94953388,  86612.68555877,  85737.0742643 ,  84869.0569707 ,
        84008.57543269,  83155.57183604,  82309.988794  ,  81471.76934389,
        80640.85694365,  79817.19546843,  79000.72920727,  78191.4028597 ,
        77389.16153251,  76593.95073643,  75805.71638293,  75024.40478097,
        74249.96263386,  73482.3370361 ]
    elseif case=="dry"
        qv_sdm = [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]

        rhod_sdm = [1.1706593 , 1.16109334, 1.15157447, 1.14210259, 1.13267763,
        1.12329951, 1.11396816, 1.10468366, 1.09546078, 1.08630939,
        1.0772289 , 1.06821874, 1.05927836, 1.05040718, 1.04160466,
        1.03287025, 1.02420341, 1.01560358, 1.00707025, 0.99860288,
        0.99020095, 0.98186394, 0.97359133, 0.96538261, 0.95723729,
        0.94915484, 0.9411348 , 0.93317665, 0.92527991, 0.9174441 ]

        thetad_sdm = [297.9       , 297.9       , 297.9       , 297.9       ,
        297.9       , 297.9       , 297.9       , 297.95857143,
        298.54428571, 299.13      , 299.71571429, 300.30142857,
        300.88714286, 301.47285714, 302.05857143, 302.64428571,
        303.23      , 303.81571429, 304.40142857, 304.98714286,
        305.57285714, 306.15857143, 306.74428571, 307.33      ,
        307.91571429, 308.50142857, 309.08714286, 309.67285714,
        310.25857143, 310.84428571]

        T_sdm = [298.00613302, 297.03034695, 296.05456089, 295.07877482,
        294.10298875, 293.12720268, 292.15141661, 291.25578532,
        291.08036742, 290.90289845, 290.72337913, 290.54181187,
        290.35819905, 290.17254308, 289.98484633, 289.79511119,
        289.60334002, 289.40953518, 289.21369903, 289.01583391,
        288.81594217, 288.61402614, 288.41008814, 288.20413049,
        287.9961555 , 287.78616548, 287.57416273, 287.36014953,
        287.14412817, 286.92610092]

        P_sdm = [100124.81122361,  98981.48097221,  97847.50862761,  96722.84806231,
        95607.45322506,  94501.27814093,  93404.27691148,  92341.83102036,
        91515.72749575,  90695.88226719,  89882.25147442,  89074.79343103,
        88273.46673215,  87478.23025216,  86689.04314257,  85905.86482972,
        85128.65501271,  84357.37366115,  83591.9810131 ,  82832.43757294,
        82078.70410926,  81330.74165281,  80588.51149443,  79851.97518305,
        79121.09452364,  78395.83157525,  77676.14864902,  76962.00830621,
        76253.3733563 ,  75550.20685504]
    end

    return (; z_sdm, qv_sdm, rhod_sdm, thetad_sdm, T_sdm, P_sdm, ql_sdm)
end
